import{r as e,g as t,n as r,j as o,i as n,h as s,p as i,s as l,u as a,a7 as c,a8 as u}from"./vendor-ui-lyVl3Qm-.js";import{L as d}from"./index-BefZInMZ.js";var p="ScrollArea",[h]=n(p),[f,m]=h(p),w=e.forwardRef((n,i)=>{const{__scopeScrollArea:l,type:a="hover",dir:c,scrollHideDelay:u=600,...d}=n,[p,h]=e.useState(null),[m,w]=e.useState(null),[g,v]=e.useState(null),[b,S]=e.useState(null),[y,E]=e.useState(null),[x,R]=e.useState(0),[C,T]=e.useState(0),[_,L]=e.useState(!1),[P,A]=e.useState(!1),D=t(i,e=>h(e)),j=r(c);return o.jsx(f,{scope:l,type:a,dir:j,scrollHideDelay:u,scrollArea:p,viewport:m,onViewportChange:w,content:g,onContentChange:v,scrollbarX:b,onScrollbarXChange:S,scrollbarXEnabled:_,onScrollbarXEnabledChange:L,scrollbarY:y,onScrollbarYChange:E,scrollbarYEnabled:P,onScrollbarYEnabledChange:A,onCornerWidthChange:R,onCornerHeightChange:T,children:o.jsx(s.div,{dir:j,...d,ref:D,style:{position:"relative","--radix-scroll-area-corner-width":x+"px","--radix-scroll-area-corner-height":C+"px",...n.style}})})});w.displayName=p;var g="ScrollAreaViewport",v=e.forwardRef((r,n)=>{const{__scopeScrollArea:i,children:l,nonce:a,...c}=r,u=m(g,i),d=e.useRef(null),p=t(n,d,u.onViewportChange);return o.jsxs(o.Fragment,{children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),o.jsx(s.div,{"data-radix-scroll-area-viewport":"",...c,ref:p,style:{overflowX:u.scrollbarXEnabled?"scroll":"hidden",overflowY:u.scrollbarYEnabled?"scroll":"hidden",...r.style},children:o.jsx("div",{ref:u.onContentChange,style:{minWidth:"100%",display:"table"},children:l})})]})});v.displayName=g;var b="ScrollAreaScrollbar",S=e.forwardRef((t,r)=>{const{forceMount:n,...s}=t,i=m(b,t.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:a}=i,c="horizontal"===t.orientation;return e.useEffect(()=>(c?l(!0):a(!0),()=>{c?l(!1):a(!1)}),[c,l,a]),"hover"===i.type?o.jsx(y,{...s,ref:r,forceMount:n}):"scroll"===i.type?o.jsx(E,{...s,ref:r,forceMount:n}):"auto"===i.type?o.jsx(x,{...s,ref:r,forceMount:n}):"always"===i.type?o.jsx(R,{...s,ref:r}):null});S.displayName=b;var y=e.forwardRef((t,r)=>{const{forceMount:n,...s}=t,l=m(b,t.__scopeScrollArea),[a,c]=e.useState(!1);return e.useEffect(()=>{const e=l.scrollArea;let t=0;if(e){const r=()=>{window.clearTimeout(t),c(!0)},o=()=>{t=window.setTimeout(()=>c(!1),l.scrollHideDelay)};return e.addEventListener("pointerenter",r),e.addEventListener("pointerleave",o),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",r),e.removeEventListener("pointerleave",o)}}},[l.scrollArea,l.scrollHideDelay]),o.jsx(i,{present:n||a,children:o.jsx(x,{"data-state":a?"visible":"hidden",...s,ref:r})})}),E=e.forwardRef((t,r)=>{const{forceMount:n,...s}=t,a=m(b,t.__scopeScrollArea),c="horizontal"===t.orientation,u=Y(()=>p("SCROLL_END"),100),[d,p]=(h="hidden",f={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},e.useReducer((e,t)=>f[e][t]??e,h));var h,f;return e.useEffect(()=>{if("idle"===d){const e=window.setTimeout(()=>p("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(e)}},[d,a.scrollHideDelay,p]),e.useEffect(()=>{const e=a.viewport,t=c?"scrollLeft":"scrollTop";if(e){let r=e[t];const o=()=>{const o=e[t];r!==o&&(p("SCROLL"),u()),r=o};return e.addEventListener("scroll",o),()=>e.removeEventListener("scroll",o)}},[a.viewport,c,p,u]),o.jsx(i,{present:n||"hidden"!==d,children:o.jsx(R,{"data-state":"hidden"===d?"hidden":"visible",...s,ref:r,onPointerEnter:l(t.onPointerEnter,()=>p("POINTER_ENTER")),onPointerLeave:l(t.onPointerLeave,()=>p("POINTER_LEAVE"))})})}),x=e.forwardRef((t,r)=>{const n=m(b,t.__scopeScrollArea),{forceMount:s,...l}=t,[a,c]=e.useState(!1),u="horizontal"===t.orientation,d=Y(()=>{if(n.viewport){const e=n.viewport.offsetWidth<n.viewport.scrollWidth,t=n.viewport.offsetHeight<n.viewport.scrollHeight;c(u?e:t)}},10);return B(n.viewport,d),B(n.content,d),o.jsx(i,{present:s||a,children:o.jsx(R,{"data-state":a?"visible":"hidden",...l,ref:r})})}),R=e.forwardRef((t,r)=>{const{orientation:n="vertical",...s}=t,i=m(b,t.__scopeScrollArea),l=e.useRef(null),a=e.useRef(0),[c,u]=e.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=M(c.viewport,c.content),p={...s,sizes:c,onSizesChange:u,hasThumb:Boolean(d>0&&d<1),onThumbChange:e=>l.current=e,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:e=>a.current=e};function h(e,t){return function(e,t,r,o="ltr"){const n=O(r),s=n/2,i=t||s,l=n-i,a=r.scrollbar.paddingStart+i,c=r.scrollbar.size-r.scrollbar.paddingEnd-l,u=r.content-r.viewport,d="ltr"===o?[0,u]:[-1*u,0];return H([a,c],d)(e)}(e,a.current,c,t)}return"horizontal"===n?o.jsx(C,{...p,ref:r,onThumbPositionChange:()=>{if(i.viewport&&l.current){const e=U(i.viewport.scrollLeft,c,i.dir);l.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{i.viewport&&(i.viewport.scrollLeft=e)},onDragScroll:e=>{i.viewport&&(i.viewport.scrollLeft=h(e,i.dir))}}):"vertical"===n?o.jsx(T,{...p,ref:r,onThumbPositionChange:()=>{if(i.viewport&&l.current){const e=U(i.viewport.scrollTop,c);l.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{i.viewport&&(i.viewport.scrollTop=e)},onDragScroll:e=>{i.viewport&&(i.viewport.scrollTop=h(e))}}):null}),C=e.forwardRef((r,n)=>{const{sizes:s,onSizesChange:i,...l}=r,a=m(b,r.__scopeScrollArea),[c,u]=e.useState(),d=e.useRef(null),p=t(n,d,a.onScrollbarXChange);return e.useEffect(()=>{d.current&&u(getComputedStyle(d.current))},[d]),o.jsx(P,{"data-orientation":"horizontal",...l,ref:p,sizes:s,style:{bottom:0,left:"rtl"===a.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===a.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":O(s)+"px",...r.style},onThumbPointerDown:e=>r.onThumbPointerDown(e.x),onDragScroll:e=>r.onDragScroll(e.x),onWheelScroll:(e,t)=>{if(a.viewport){const o=a.viewport.scrollLeft+e.deltaX;r.onWheelScroll(o),W(o,t)&&e.preventDefault()}},onResize:()=>{d.current&&a.viewport&&c&&i({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:k(c.paddingLeft),paddingEnd:k(c.paddingRight)}})}})}),T=e.forwardRef((r,n)=>{const{sizes:s,onSizesChange:i,...l}=r,a=m(b,r.__scopeScrollArea),[c,u]=e.useState(),d=e.useRef(null),p=t(n,d,a.onScrollbarYChange);return e.useEffect(()=>{d.current&&u(getComputedStyle(d.current))},[d]),o.jsx(P,{"data-orientation":"vertical",...l,ref:p,sizes:s,style:{top:0,right:"ltr"===a.dir?0:void 0,left:"rtl"===a.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":O(s)+"px",...r.style},onThumbPointerDown:e=>r.onThumbPointerDown(e.y),onDragScroll:e=>r.onDragScroll(e.y),onWheelScroll:(e,t)=>{if(a.viewport){const o=a.viewport.scrollTop+e.deltaY;r.onWheelScroll(o),W(o,t)&&e.preventDefault()}},onResize:()=>{d.current&&a.viewport&&c&&i({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:k(c.paddingTop),paddingEnd:k(c.paddingBottom)}})}})}),[_,L]=h(b),P=e.forwardRef((r,n)=>{const{__scopeScrollArea:i,sizes:c,hasThumb:u,onThumbChange:d,onThumbPointerUp:p,onThumbPointerDown:h,onThumbPositionChange:f,onDragScroll:w,onWheelScroll:g,onResize:v,...S}=r,y=m(b,i),[E,x]=e.useState(null),R=t(n,e=>x(e)),C=e.useRef(null),T=e.useRef(""),L=y.viewport,P=c.content-c.viewport,A=a(g),D=a(f),j=Y(v,10);function N(e){if(C.current){const t=e.clientX-C.current.left,r=e.clientY-C.current.top;w({x:t,y:r})}}return e.useEffect(()=>{const e=e=>{const t=e.target,r=E?.contains(t);r&&A(e,P)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[L,E,P,A]),e.useEffect(D,[c,D]),B(E,j),B(y.content,j),o.jsx(_,{scope:i,scrollbar:E,hasThumb:u,onThumbChange:a(d),onThumbPointerUp:a(p),onThumbPositionChange:D,onThumbPointerDown:a(h),children:o.jsx(s.div,{...S,ref:R,style:{position:"absolute",...S.style},onPointerDown:l(r.onPointerDown,e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),C.current=E.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",y.viewport&&(y.viewport.style.scrollBehavior="auto"),N(e)}}),onPointerMove:l(r.onPointerMove,N),onPointerUp:l(r.onPointerUp,e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=T.current,y.viewport&&(y.viewport.style.scrollBehavior=""),C.current=null})})})}),A="ScrollAreaThumb",D=e.forwardRef((e,t)=>{const{forceMount:r,...n}=e,s=L(A,e.__scopeScrollArea);return o.jsx(i,{present:r||s.hasThumb,children:o.jsx(j,{ref:t,...n})})}),j=e.forwardRef((r,n)=>{const{__scopeScrollArea:i,style:a,...c}=r,u=m(A,i),d=L(A,i),{onThumbPositionChange:p}=d,h=t(n,e=>d.onThumbChange(e)),f=e.useRef(void 0),w=Y(()=>{f.current&&(f.current(),f.current=void 0)},100);return e.useEffect(()=>{const e=u.viewport;if(e){const t=()=>{if(w(),!f.current){const t=X(e,p);f.current=t,p()}};return p(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[u.viewport,w,p]),o.jsx(s.div,{"data-state":d.hasThumb?"visible":"hidden",...c,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:l(r.onPointerDownCapture,e=>{const t=e.target.getBoundingClientRect(),r=e.clientX-t.left,o=e.clientY-t.top;d.onThumbPointerDown({x:r,y:o})}),onPointerUp:l(r.onPointerUp,d.onThumbPointerUp)})});D.displayName=A;var N="ScrollAreaCorner",z=e.forwardRef((e,t)=>{const r=m(N,e.__scopeScrollArea),n=Boolean(r.scrollbarX&&r.scrollbarY);return"scroll"!==r.type&&n?o.jsx(I,{...e,ref:t}):null});z.displayName=N;var I=e.forwardRef((t,r)=>{const{__scopeScrollArea:n,...i}=t,l=m(N,n),[a,c]=e.useState(0),[u,d]=e.useState(0),p=Boolean(a&&u);return B(l.scrollbarX,()=>{const e=l.scrollbarX?.offsetHeight||0;l.onCornerHeightChange(e),d(e)}),B(l.scrollbarY,()=>{const e=l.scrollbarY?.offsetWidth||0;l.onCornerWidthChange(e),c(e)}),p?o.jsx(s.div,{...i,ref:r,style:{width:a,height:u,position:"absolute",right:"ltr"===l.dir?0:void 0,left:"rtl"===l.dir?0:void 0,bottom:0,...t.style}}):null});function k(e){return e?parseInt(e,10):0}function M(e,t){const r=e/t;return isNaN(r)?0:r}function O(e){const t=M(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-r)*t;return Math.max(o,18)}function U(e,t,r="ltr"){const o=O(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-n,i=t.content-t.viewport,l=s-o,a=u(e,"ltr"===r?[0,i]:[-1*i,0]);return H([0,i],[0,l])(a)}function H(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(r-e[0])}}function W(e,t){return e>0&&e<t}var X=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},o=0;return function n(){const s={left:e.scrollLeft,top:e.scrollTop},i=r.left!==s.left,l=r.top!==s.top;(i||l)&&t(),r=s,o=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(o)};function Y(t,r){const o=a(t),n=e.useRef(0);return e.useEffect(()=>()=>window.clearTimeout(n.current),[]),e.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(o,r)},[o,r])}function B(e,t){const r=a(t);c(()=>{let t=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(t),o.unobserve(e)}}},[e,r])}var F=w,q=v,J=z;function $({className:e,children:t,...r}){return o.jsxs(F,{"data-slot":"scroll-area",className:d("relative",e),...r,children:[o.jsx(q,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),o.jsx(V,{}),o.jsx(J,{})]})}function V({className:e,orientation:t="vertical",...r}){return o.jsx(S,{"data-slot":"scroll-area-scrollbar",orientation:t,className:d("flex touch-none p-px transition-colors select-none","vertical"===t&&"h-full w-2.5 border-l border-l-transparent","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent",e),...r,children:o.jsx(D,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const K={maxRequests:10,windowMs:6e4,cooldownMs:3e4},Z="chat_rate_limit";function G(e){try{localStorage.setItem(Z,JSON.stringify(e))}catch{}}function Q(e=K){const t=Date.now(),r=function(){try{const e=localStorage.getItem(Z);if(e)return JSON.parse(e)}catch{}return{timestamps:[],blockedUntil:null}}();return r.blockedUntil&&t<r.blockedUntil?{allowed:!1,remainingRequests:0,retryAfterMs:r.blockedUntil-t}:(r.blockedUntil&&t>=r.blockedUntil&&(r.blockedUntil=null),r.timestamps=r.timestamps.filter(r=>t-r<e.windowMs),r.timestamps.length>=e.maxRequests?(r.blockedUntil=t+e.cooldownMs,G(r),{allowed:!1,remainingRequests:0,retryAfterMs:e.cooldownMs}):(r.timestamps.push(t),G(r),{allowed:!0,remainingRequests:e.maxRequests-r.timestamps.length,retryAfterMs:null}))}const ee=[/ignore\s+(all\s+)?previous\s+(instructions?|prompts?|rules?)/i,/forget\s+(all\s+)?previous\s+(instructions?|prompts?|context)/i,/disregard\s+(all\s+)?previous/i,/override\s+(system|instructions?)/i,/you\s+are\s+now\s+(a|an|the)\s/i,/act\s+as\s+(a|an|the)\s+(different|new)/i,/new\s+role\s*:/i,/system\s*prompt\s*:/i,/repeat\s+(the\s+)?(system\s+)?prompt/i,/show\s+(me\s+)?(the\s+)?(system\s+)?(prompt|instructions)/i,/what\s+(are|is)\s+(your|the)\s+(system\s+)?(prompt|instructions|rules)/i,/```\s*(javascript|python|bash|sh|exec|eval)/i,/<script[\s>]/i],te="chat_security_log";function re(){try{const e=localStorage.getItem(te);return e?JSON.parse(e):[]}catch{return[]}}const oe="chat_audit_log";function ne(e){try{const t=localStorage.getItem(oe),r=t?JSON.parse(t):[];r.push(e);const o=r.slice(-200);localStorage.setItem(oe,JSON.stringify(o))}catch{}}function se(){try{const e=localStorage.getItem(oe);return e?JSON.parse(e):[]}catch{return[]}}async function ie(e){const t=Q();if(!t.allowed){const e=Math.ceil((t.retryAfterMs||3e4)/1e3);return ne({timestamp:Date.now(),action:"chat_blocked",details:`Rate limit überschritten. Retry nach ${e}s`}),{success:!1,message:`Zu viele Anfragen. Bitte warten Sie ${e} Sekunden.`,error:"RATE_LIMIT",rateLimitInfo:t}}const r=function(e){if(!e||"string"!=typeof e)return{sanitized:"",blocked:!0,reason:"Leere Eingabe"};let t=e.trim();if(0===t.length)return{sanitized:"",blocked:!0,reason:"Leere Eingabe"};t.length>2e3&&(t=t.slice(0,2e3));for(const r of ee)if(r.test(t))return{sanitized:"",blocked:!0,reason:"Unzulässige Eingabe erkannt"};return t=t.replace(/<[^>]*>/g,""),t=t.replace(/\s{3,}/g,"  "),{sanitized:t,blocked:!1}}(e.message);if(r.blocked)return function(e,t){try{const r=localStorage.getItem(te),o=r?JSON.parse(r):[];o.push({timestamp:Date.now(),reason:t,inputPreview:e.slice(0,100)});const n=o.slice(-100);localStorage.setItem(te,JSON.stringify(n))}catch{}}(e.message,r.reason||"blocked"),ne({timestamp:Date.now(),action:"chat_blocked",details:`Eingabe blockiert: ${r.reason}`,inputPreview:e.message.slice(0,50)}),{success:!1,message:"Ihre Nachricht konnte nicht verarbeitet werden. Bitte formulieren Sie Ihre Frage neu.",error:"BLOCKED",rateLimitInfo:t};const o=await async function(){try{const e=localStorage.getItem("spark_kv_ai_training_data");if(!e)return"";const t=JSON.parse(e).filter(e=>e.active);return 0===t.length?"":"\n\nZUSÄTZLICHES WISSEN (Admin-gepflegt):\n"+t.map(e=>`[${e.title}]\n${e.content}`).join("\n\n")}catch{return""}}(),n=e.systemPrompt+o+"\n\nAKTUELLE KUNDENFRAGE:\n"+r.sanitized+"\n\nAntworte jetzt:";try{ne({timestamp:Date.now(),action:"chat_request",details:"Chat-Anfrage gesendet",inputPreview:r.sanitized.slice(0,50)});return{success:!0,message:await window.spark.llm(n,"gpt-4o",!1),rateLimitInfo:t}}catch(s){const e=s instanceof Error?s.message:"unknown";return console.error("Chat-Service Fehler:",e),ne({timestamp:Date.now(),action:"chat_error",details:`LLM-Fehler: ${e.slice(0,100)}`}),{success:!1,message:"Der KI-Berater ist momentan nicht erreichbar. Bitte versuchen Sie es später erneut oder nutzen Sie unser Kontaktformular.",error:"SERVICE_ERROR",rateLimitInfo:t}}}export{$ as S,re as a,se as g,ie as s};
